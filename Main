# -*- coding: utf8 -*-

import pygame
from pygame.locals import *
import traceback
pygame.init()

try:
    #Ouverture de la fenêtre Pygame
    fenetre=pygame.display.set_mode((600,800))
    #Chargement et collage du fond
    fond = pygame.image.load("background1.jpg").convert()
    fenetre.blit(fond, (0,0))
    #Chargement et collage du vaisseau
    Vaisseau=pygame.image.load("Vaisseau.png").convert_alpha()
    Vaisseau_rect=Vaisseau.get_rect()
    Vaisseau_rect.left=268
    Vaisseau_rect.top=736
    fenetre.blit(Vaisseau,Vaisseau_rect)
    #Chargement du tir
    tir=pygame.image.load("tir.png").convert_alpha()
    tir_rect=tir.get_rect()
    #on crée des listes qui contiendront les coordonnées du tir
    liste_tir =[]
    
    #On active la répétition des touches
    pygame.key.set_repeat(3,5) 
    pygame.display.flip()
    continuer=1

    
    keys = [False, False, False]
    
    timer=pygame.time.Clock()
    temps=-500
    class objet:
        def __init__(self, image, hauteur, vitesse,x):
            self.vitesse = vitesse
            self.image = image
            self.pos = image.get_rect().move(x, hauteur)
        def move(self):
            self.pos = self.pos.move(0, self.vitesse)
            
    
    while continuer:
        for event in pygame.event.get():
            #moyen pour sortir de la boucle
            if event.type==QUIT:
                continuer=0 
            if event.type==KEYDOWN:
                if event.key==K_a:
                    keys[0]=True           
                if event.key==K_d:
                    keys[1]=True     
                if event.key==K_w:
                     keys[2]=True                   
            if event.type==KEYUP: 
                if event.key==K_a:
                    keys[0]=False
                if event.key==K_d:
                    keys[1]=False
                if event.key==K_w:
                    keys[2]=False
        if keys[0]:
            Vaisseau_rect=Vaisseau_rect.move(-5,0)
            #on déplace le rectangle de l'image de 5 pixel vers la gauche
            if Vaisseau_rect.left<0:
                #On empêche le vaisseau de sortir de la fenêtre
                Vaisseau_rect.left=0
        if keys[1]:
            Vaisseau_rect=Vaisseau_rect.move(5,0)
            if Vaisseau_rect.right>600:
                Vaisseau_rect.right=600
                #On empêche le vaisseau de sortir de la fenêtre
        if keys[2]:
            if pygame.time.get_ticks()>= temps+500:                        
                    temps=pygame.time.get_ticks()
                    print("Appuyé sur z")
                    o = objet(tir,736, -10,Vaisseau_rect.left +32)
                    liste_tir.append(o)
                
            
        fenetre.blit(fond, (0,0))
        for o in liste_tir:
            o.move()
            if o.pos.top <= 16:
                liste_tir=liste_tir[1:]
                print("patate")
            fenetre.blit(o.image, o.pos)
        fenetre.blit(Vaisseau,Vaisseau_rect)    
        pygame.display.update()
        clock=timer.tick(60) #Limite les FPS à 60
        
except:
    traceback.print_exc()
finally:
    pygame.quit()
    exit()
